Руководство для написания скриптов в NormCAD/NormFEM (стиль «вики»)
Введение
NormCAD — программный комплекс для расчёта строительных конструкций по нормам. Он имеет встроенный интерпретируемый язык и поддерживает экспорт алгоритмов в Visual Basic. Для автоматизации расчётов предусмотрены библиотеки API NormCAD и API NormFEM, которые позволяют управлять модулями NormCAD из внешних приложений (например, VBA или Python) и получать результаты расчётов.
Данная вики собирает ключевую информацию из официальной документации и примеров, необходимую для написания скриптов, связанных с проведением проверок по нормам. В качестве примера рассматривается общая проверка несущей способности элемента, но описанные шаги можно адаптировать под любую нормативную проверку.
1. Среда программирования NormCAD
1.1 Язык и отладчик
Встроенный язык NormCAD ориентирован на инженерные расчёты; он интерпретируется и автоматически документирует выполняемые строки[1].
Алгоритмы хранятся в файлах модулей (расширение .nrb). Для их создания используется «Мастер создания модулей».
Отладчик позволяет редактировать код, выполнять пошаговое выполнение и просматривать значения переменных.
1.2 Экспорт кода в Visual Basic
Для ускорения расчётов или интеграции с другими системами алгоритмы NormCAD можно экспортировать в Visual Basic (VBA). В менеджере NormCAD доступна кнопка «Создать VB проект (EXE) на API», которая формирует проект на основе активного документа, использующий API NormCAD[2].
В NormFEM имеется команда «Экспорт в VB программу» на кнопке «Сохранить» для автоматического создания кода с использованием API NormFEM[3].
2. Общий порядок выполнения проверки
Ниже представлен типовой порядок действий при автоматизации проверки несущей способности элемента:
Формирование расчётной схемы. Создайте проект в NormFEM (если требуется конечно‑элементный анализ) либо используйте существующие файлы нагрузки и сечений.
Экспорт автоматического кода. Используйте команды «Создать VB модуль» (в NormCAD) или «Экспорт в VB программу» (в NormFEM) для получения шаблона кода на VBA. Шаблон содержит вызовы API и массивы исходных данных.
Подготовка скрипта. В редакторе VBA (например, в Excel) создайте новый модуль, подключите библиотеки API (NCAPI.dll для NormCAD и ncfemapi.dll для NormFEM) и вставьте экспортированный код.
Передача данных. Заполните массивы исходных данных (условия, переменные, таблицы узлов и элементов) и передайте их через функции API (см. раздел 3).
Выполнение расчёта. Запустите расчёт через ClcCalc (NormCAD) или Calc (NormFEM).
Анализ результатов. Считайте коэффициенты использования (MaxResult), массивы усилий (GetArrNM, GetArrQ) и перемещений (GetArrZ), сравните с нормативными значениями и сформируйте отчёт.
Формирование отчёта. Сохраните отчёт через MakeReport и, при необходимости, оформите его в формате Word (SendToWord)[4].
3. API NormCAD
API NormCAD — библиотека NCAPI.dll, предоставляющая доступ к модулям NormCAD из внешнего приложения. Ниже приведены ключевые методы и переменные, необходимых для выполнения проверки.
3.1 Создание объектов
Dim ncApiR As ncApi.Report
Dim Vars As Object

' Создаём экземпляр объекта отчёта
Set ncApiR = New ncApi.Report

' Создаём объект переменных расчётного модуля. Имя библиотеки модуля
' зависит от конкретного нормативного расчёта (пример имени показан в документации).
Set Vars = CreateObject("NC_XXXXXXXXXXXXXXX.Vars")
3.2 Настройка переменных задания
Перед передачей данных необходимо задать переменные:
Norm – название нормативного документа (например, "СП 16.13330.2017")[5].
TaskName – название задания/расчёта (отображается в отчёте)[5].
Unit – перечень пунктов задания (строка, например "п.5.2, п.5.3")[6].
3.3 Передача исходных данных и условий
3.4 Запуск расчёта и получение результатов
Запуск вычислений: ClcCalc (предварительно должны быть заданные переменные TaskName и Unit)[11].
Получение отчёта: MakeReport(File As String) сохраняет отчёт в файл, SendToWord(File As String) сохраняет отчёт с рамкой и штампом в формате Word[4].
Проверка ключа: TestKey() возвращает True, если аппаратный ключ защиты подключён[4].
Максимальный коэффициент использования: MaxResult – read‑only свойство, возвращает максимальное значение коэффициента использования по проверяемому элементу[12].
Пример минимального вызова расчёта:
Sub RunCheck()
    ' Настройка имени норматива и задания
    ncApiR.Norm = "СП 16.13330.2017"
    ncApiR.TaskName = "Проверка балки"
    ncApiR.Unit = "п.5.2"

    ' Загрузка нормативного модуля
    ncApiR.ClcLoadNorm

    ' Передача данных и условий (пример с заранее заполненными массивами)
    ncApiR.SetVars Vars
    ncApiR.SetConds ArConds
    ncApiR.ClcLoadData
    ncApiR.ClcLoadConds

    ' Запуск расчёта
    ncApiR.ClcCalc

    ' Сохранение отчёта
    ncApiR.MakeReport "C:\\Reports\\Balka_Report.txt"

    MsgBox "Максимальный коэффициент использования: " & ncApiR.MaxResult
End Sub
4. API NormFEM
API NormFEM — библиотека ncfemapi.dll для взаимодействия с модулем конечных элементов NormFEM. Она используется, когда необходимо определить усилия и перемещения в элементах конструкции и затем передать их в NormCAD для нормативной проверки.
4.1 Создание и настройка объекта
Dim nfApi As ncfemapi.Main
Set nfApi = New ncfemapi.Main
Перед использованием необходимо задать путь к папкам, временным файлам и имени проекта, а также указать форму, содержащую элементы для отображения прогресса и протокола:
nfApi.SetPath AppPath:="C:\\Program Files\\NormFEM", _
             TempDir:="C:\\Temp", _
             Project:="FrameProject", _
             ParentForm:=Me ' форма с txtProgress и txtReport
4.2 Передача данных (таблицы)
Данные передаются таблицами, где имя таблицы (TblName) соответствует расширению файла в проекте. Основные таблицы:
Пример передачи массива для таблицы Материалы:
Dim Arr() As String
ReDim Arr(1 To 10) ' Пример размера
' Заполнить массив строками таблицы
nfApi.SetArr "m00", Arr
4.3 Запуск расчёта и остановка
Calc — запускает расчёт[17].
StopEx — останавливает выполнение (если нужно прервать)[18].
4.4 Получение результатов
После расчёта можно получить массивы с результатами:
4.5 Дополнительные свойства
Steps — количество промежуточных точек на элемент для детализации распределения усилий[23].
Mode3D (только чтение) — возвращает True для трёхмерной задачи и False для плоской[24].
4.6 Пример использования API NormFEM
Sub FEMAnalysis()
    Dim nfApi As ncfemapi.Main
    Set nfApi = New ncfemapi.Main

    ' Настройка путей и проекта
    nfApi.SetPath "C:\\NormFEM", "C:\\Temp", "FrameExample", Me

    ' Передача таблиц (пример заполнения массива материалов)
    Dim mArr() As String
    ReDim mArr(1 To 2)
    mArr(1) = "Steel; 2.55e5; 0.3"
    mArr(2) = "Concrete; 3e4; 0.2"
    nfApi.SetArr "m00", mArr

    ' Передача таблиц узлов и элементов (g01, g02, g03)
    ' ... (заполнение массивов ArG01(), ArG02(), ArG03())

    ' Запуск расчёта
    nfApi.Calc

    ' Получение перемещений
    Dim ArrZ() As Double
    nfApi.GetArrZ ArrZ

    ' Дальнейшая обработка результатов...

    ' Освобождение объекта
    Set nfApi = Nothing
End Sub
5. Практические советы
Проверяйте версию NormCAD/NormFEM. API может изменяться между версиями, поэтому убедитесь, что используете актуальную документацию.
Работайте в отдельном окружении. Для интеграции с Excel или Python рекомендуется создать копию проектов и выполнять автоматизацию на копиях, чтобы не потерять исходные данные.
Логирование. Функции txtProgress и txtReport в форме позволяют отслеживать ход расчёта и протокол; запишите их значения в файл для последующего анализа.
Комбинации нагрузок. Для расчётов по сочетаниям усилий используйте функции NormCAD (например, модуль «РСУ») или пишите отдельные процедуры в VBA, суммирующие результаты, полученные из GetArrNM/GetArrQ.
Генерация отчётов. После выполнения проверки полезно автоматизировать сохранение отчётов в Word с помощью SendToWord и добавить макросы Word для оформления (подписи, штампы).
Заключение
Данная вики предоставляет базовую структуру для написания скриптов с использованием API NormCAD и API NormFEM. Следуя шагам подготовки данных, запуска расчёта и чтения результатов, вы можете автоматизировать любую нормативную проверку: расчёт прочности и устойчивости, огнестойкости, теплотехнический анализ и т.п. Используйте приведённые функции и примеры в качестве основы и адаптируйте их под конкретные нормы и требования вашей задачи.

[1] [2] [3] [4] [5] [6] [7] [8] [9] [10] [11] [12] [13] [14] [15] [16] [17] [18] [19] [20] NCBkP.pdf
https://normcad.ru/s/book/NCBkP.pdf
[21] [22] [23] [24] normcad.ru
https://normcad.ru/s/API_NormFEM.htm